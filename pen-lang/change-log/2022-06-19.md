# Progress report in Pen programming language

## June 19th, 2022

[@raviqqe](https://github.com/raviqqe)

---

# Agenda

- Progress report
  - Relaxed atomic operations in reference counting
- Next plans

---

# Progress report

---

# Relaxed atomic operations in reference counting

- Part of [the Perceus reference counting algorithm](https://www.microsoft.com/en-us/research/publication/perceus-garbage-free-reference-counting-with-reuse/)
- Non-atomic operations in reference counting

```sh
> time ./app > /dev/null
./app > /dev/null  15.95s user 0.06s system 100% cpu 15.960 total
```

---

## Benchmark

- Map insertion
- Element count: 100,000
- ~20% improvement in time

Before:

```sh
> time ./app
./app  15.56s user 0.08s system 99% cpu 15.646 total
```

After:

```sh
> time ./app
./app  10.26s user 0.14s system 97% cpu 10.628 total
```

---

# Next plans

- Reference counting optimization
  - Unboxing small records [#671](https://github.com/pen-lang/pen/issues/671)
- Proper C calling convention in FFI [#444](https://github.com/pen-lang/pen/issues/444)
  - Compiling to MLIR?

---

# Summary

- Progress
  - Heap reuse in record updates
- Next plans
  - Record unboxing
