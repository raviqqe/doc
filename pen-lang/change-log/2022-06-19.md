# Progress report in Pen programming language

## June 19th, 2022

[@raviqqe](https://github.com/raviqqe)

---

# Agenda

- Progress report
  - Relaxed atomic operations in reference counting
- Next plans

---

# Progress report

---

# Relaxed atomic operations in reference counting

- Reference counting can use atomic operations with no ordering when references are never shared by multiple threads.
- Part of [the Perceus reference counting algorithm](https://www.microsoft.com/en-us/research/publication/perceus-garbage-free-reference-counting-with-reuse/)

---

## Benchmark

- Conway's game of life
- Size: 20 x 40
- Iteration: 1,000
- ~30% improvement in time

Before:

```sh
> time ./app
./app  15.56s user 0.08s system 99% cpu 15.646 total
```

After:

```sh
> time ./app
./app  10.26s user 0.14s system 97% cpu 10.628 total
```

---

# Next plans

- Reference counting optimization
  - Unboxing small records [#671](https://github.com/pen-lang/pen/issues/671)
- Proper C calling convention in FFI [#444](https://github.com/pen-lang/pen/issues/444)
  - Compiling to MLIR?

---

# Summary

- Progress
  - Heap reuse in record updates
- Next plans
  - Record unboxing
