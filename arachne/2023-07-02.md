# Arachne VM

[@raviqqe](https://github.com/raviqqe)

---

# Progress from the last meetup

- Function calls
- Tail call optimization
- ***

---

# Virtual machine

- Stack machine

## Instructions

`Add`, `And`, `Branch`, `Call`, `Close`, `Divide`, `Drop`, `Dump`, `Environment`, `Equal`, `Float64`, `Get`, `GreaterThan`, `GreaterThanOrEqual`, `Integer32`, `Jump`, `Length`, `LessThan`, `LessThanOrEqual`, `Multiply`, `Nil`, `Not`, `NotEqual`, `Or`, `Peek`, `Return`, `Set`, `Subtract`, `Symbol`, `TailCall`

- Pushing constants: `Nil`, `Float64`, `Integer32`, `Symbol`
- Functions: `Call`, `TailCall`, `Return`
- Closure environment: `Environment`
- Local/global variables: `Peek`
- Array operation: `Get`, `Set`

---

# Types

- Float64
- Symbol
- Function
- Array
- Nil
  - `()` = `0` = `false`

---

# Design decisions

- Operand evaluation order & argument order in a stack
  - Scheme doesn't specify its operand evaluation order in its specification.
- Tight or loose coupling between bytecode compiler and VM
  - Is it ok to embed runtime values into bytecodes?
  - Do we want to save bytecodes of modules in a file system?

---

# Next tasks...

- `call` instruction
- Closures

---

# Summary

- Daydreaming a language is fun.

---

# Ribbit

- https://github.com/udem-dlteam/ribbit
- AOT compiler + RVM
- Everything is a rib.
  - Rib is a three-word data structure.

## Objects

| #1  | #2  | #3       |
| --- | --- | -------- |
| car | cdr | type tag |

## Bytecodes

- You can GC bytecodes!

| #1                 | #2      | #3                          |
| ------------------ | ------- | --------------------------- |
| instruction number | operand | pointer to next instruction |
