# Introducing Arachne VM (ä»®)

[@raviqqe](https://github.com/raviqqe)

---

# Progress from the last meetup

- Function calls
- Tail call optimization
- Miscellous bug fixes and optimization

---

# Benchmark

```sh
TBD
```

---

# Arachne VM

- Stack machine

## Instructions

`Add`, `And`, `Branch`, `Call`, `Close`, `Divide`, `Drop`, `Dump`, `Environment`, `Equal`, `Float64`, `Get`, `GreaterThan`, `GreaterThanOrEqual`, `Integer32`, `Jump`, `Length`, `LessThan`, `LessThanOrEqual`, `Multiply`, `Nil`, `Not`, `NotEqual`, `Or`, `Peek`, `Return`, `Set`, `Subtract`, `Symbol`, `TailCall`

---

# Instructions

- Pushing constants: `Nil`, `Float64`, `Integer32`, `Symbol`
- Functions: `Call`, `TailCall`, `Return`
- Closure environment: `Environment`
- Local/global variables: `Peek`
- Array operations: `Get`, `Set`
- Arithmetic operations: `Add`, `Subtract`, `Multiply`, `Divide`
- Boolean operations: `Not`, `And`, `Or`
- Comparison operations: `Equal`, `NotEqual`, `LessThan`, `LessThanOrEqual`, ...

---

# Design decisions

- Operand evaluation order & argument order in a stack
  - Scheme doesn't specify its operand evaluation order in its specification.
- Tight or loose coupling between bytecode compiler and VM
  - Is it ok to embed runtime values into bytecodes?
  - Do we want to save bytecodes of modules in a file system?

---

# Next tasks...

- May implement delimited continuations
  - This requires some cleanup and design.
  - `SubContinuation` type?
  - Single stack for everything (temporary values, frame info, prompts?)

---

# Summary

- Building a VM is fun.
